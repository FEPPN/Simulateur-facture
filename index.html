<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Simuler ma facture d'électricité EDF</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  window.process = { env: { NODE_ENV: 'production' } };
</script>
<style>
/* 1. Police Avenir (avec fallback) - Application universelle */
body, input, button, select, textarea { 
  font-family: 'Avenir', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
}

body {
  background-color: #f3f4f6; /* Légèrement gris pour contraster avec les cartes blanches */
  min-height: 100vh;
}

/* 2. Réglage global des Radius à 5px */
.radius-5 {
  border-radius: 5px !important;
}

/* NOUVEAU : Suppression de toute surbrillance (outline/focus ring) au clic */
button:focus, input:focus, select:focus, a:focus {
  outline: none !important;
  --tw-ring-offset-width: 0px;
  --tw-ring-width: 0px;
  --tw-ring-color: transparent;
  box-shadow: none !important; /* Retire les ombres de focus générées par Tailwind */
}

/* Style des sliders */
input[type="range"]::-webkit-slider-runnable-track {
  height: 6px; 
  cursor: pointer;
  background: linear-gradient(to right, #2B2B2B var(--range-progress, 0%), #e5e7eb var(--range-progress, 0%));
  border-radius: 5px; /* Radius 5px */
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  border: 1px solid #2B2B2B;
  height: 16px; 
  width: 16px; 
  border-radius: 50%; /* On garde le rond pour le curseur lui-même, c'est standard */
  background: #e5e7eb; 
  cursor: pointer; 
  margin-top: -5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* Boutons d'options */
.option-button {
  transition: all 0.2s;
  border: 1px solid #d1d5db; /* Bordure plus fine */
  color: #374151;
  background-color: white;
  cursor: pointer;
  padding: 0.75rem 1rem;
  border-radius: 5px; /* Radius 5px */
  font-weight: 500;
  text-align: center;
}
.option-button:hover {
  background-color: rgba(102, 126, 234, 0.1);
  border-color: #667eea;
  color: #667eea;
}
.option-button.active {
  background-color: #667eea;
  border-color: #667eea;
  color: white;
  box-shadow: none; 
}

/* Cartes principales */
.card-common {
  background: white;
  border-radius: 10px; /* Radius passé à 10px pour les grands encadrés */
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  overflow: visible;
  height: 100%; /* Pour aligner les hauteurs globales si besoin */
}

/* 3. Headers : Même hauteur pour les deux bandeaux */
.header-common {
  padding: 1.25rem; /* Padding réduit de 1.5rem à 1.25rem */
  border-top-left-radius: 10px; 
  border-top-right-radius: 10px; 
  min-height: 100px; /* Hauteur minimale réduite de 140px à 100px */
  display: flex;
  flex-direction: column;
  justify-content: center; /* Centre le contenu verticalement */
}

/* Modification des dégradés selon vos codes couleurs */
.header-left {
  background: linear-gradient(135deg, #5145E5 0%, #9134E9 100%);
  color: white;
}

.header-right {
  background: linear-gradient(135deg, #16B7A5 0%, #0C9488 100%);
  color: white;
}

.content-area {
  padding: 2rem;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

/* 4. Suppression des encadrés (Partie Gauche) */
.input-section {
  background-color: transparent;
  border-radius: 0;
  padding: 0.5rem 0; /* Juste un peu d'espace vertical */
  box-shadow: none;
  border: none;
}

/* Modification majeure : Le popover devient un bloc accordéon */
#detailsPopover {
  position: relative; 
  width: 100%;
  margin-top: 1rem;
  
  /* Couleurs demandées */
  background-color: #F0F6FF; 
  color: #1F40AF;           
  border-left: 8px solid #C0DBFE; 
  
  border-radius: 5px;
  box-shadow: none; 
  
  /* Gestion de l'animation d'ouverture (accordéon) */
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  padding: 0 1.5rem; /* Padding horizontal seulement au début */
  visibility: hidden;
  
  transition: all 0.4s ease-in-out;
}

#detailsPopover.show {
  /* État ouvert */
  max-height: 500px; /* Valeur arbitraire suffisante pour le contenu */
  opacity: 1;
  visibility: visible;
  padding: 1.5rem; /* On remet le padding vertical */
  margin-bottom: 1rem; /* Un peu d'espace en bas si besoin */
}

/* Style épuré pour les lignes de détails (inspiré de votre image) */
.detail-row {
  display: flex;
  flex-direction: row; /* Modification : alignement horizontal */
  align-items: baseline; /* Alignement sur la ligne de base du texte */
  gap: 0.5rem; /* Espacement entre le libellé et la valeur */
  margin-bottom: 1rem;
  flex-wrap: wrap; /* Permet le retour à la ligne si l'écran est trop petit */
}
.detail-row:last-child {
  margin-bottom: 0;
}
.detail-label {
  font-weight: 700;
  font-size: 1rem;
  white-space: nowrap; /* Empêche le libellé d'être coupé si possible */
}
.detail-value {
  font-weight: 400;
  font-size: 1rem;
}

.result-amount {
  font-size: 30px; /* Modification : taille réduite à 30px */
  font-weight: 800;
  line-height: 1;
}

@media (max-width: 1024px) {
  /* .result-amount { font-size: 2.5rem; }  Supprimé car 30px est appliqué partout */
  .header-common { padding: 1.5rem; min-height: auto; } 
  .content-area { padding: 1.5rem; }
}
</style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-6xl mx-auto overflow-visible">
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 items-start">

    <!-- Colonne gauche -->
    <div class="card-common">
      <!-- Header violet -->
      <div class="header-common header-left">
        <div class="flex items-center gap-3 mb-4">
          <svg class="w-8 h-8 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
          </svg>
          <!-- Modification : taille titre forcée à 20px -->
          <h2 class="font-bold" style="font-size: 20px;">Vos informations</h2>
        </div>
        <p class="text-white/90 text-sm">Renseignez vos informations pour calculer votre facture estimée</p>
      </div>
      
      <!-- Contenu blanc -->
      <div class="content-area">
        <!-- Consommation annuelle -->
        <div class="input-section space-y-3">
          <label class="block text-lg font-semibold text-gray-700">Consommation annuelle</label>
          <div class="space-y-2">
            <input type="range" id="consumption" min="1000" max="25000" value="5000" step="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" style="--range-progress: 16.66%;">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">1000 kWh</span>
              <span class="text-sm text-gray-500" id="consumptionValue">5000 kWh</span>
              <span class="text-sm text-gray-500">25000 kWh</span>
            </div>
          </div>
        </div>

        <!-- Option tarifaire -->
        <div class="input-section space-y-3">
          <div class="flex items-center gap-2">
            <label class="block text-lg font-semibold text-gray-700">Option tarifaire</label>
            <div id="hphcInfoIcon" class="relative group flex items-center hidden">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-400 hover:text-gray-600 cursor-help transition-colors">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
              </svg>
              <!-- Tooltip -->
              <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 p-3 bg-gray-800 text-white text-xs text-center radius-5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50 pointer-events-none shadow-lg">
                Le calcul simule une répartition de 2/3 de votre consommation en Heures Pleines et 1/3 en Heures Creuses.
                <div class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800"></div>
              </div>
            </div>
          </div>
          <div id="warningMessage" class="hidden items-center gap-2 p-3 bg-red-50 border border-red-200 radius-5 mb-2">
            <span class="text-red-500 text-xl">⚠️</span>
            <p class="text-sm text-red-600 font-medium">L'option HP/HC n'est pas disponible pour 3 kVA</p>
          </div>
          <div class="flex gap-3">
            <button class="option-button active flex-1" data-option="Base">Base</button>
            <button class="option-button flex-1" data-option="HPHC">Heures Pleines/Creuses</button>
          </div>
        </div>

        <!-- Puissance du compteur -->
        <div class="input-section space-y-3">
          <label class="block text-lg font-semibold text-gray-700">Puissance du compteur</label>
          <div class="space-y-2">
            <input type="range" id="power" min="0" max="6" value="1" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" style="--range-progress: 16.66%;">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500">3 kVA</span>
              <span class="text-sm text-gray-500" id="powerValue">6 kVA</span>
              <span class="text-sm text-gray-500">36 kVA</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Colonne droite -->
    <div class="card-common">
      <!-- Header vert -->
      <div class="header-common header-right">
        <!-- Ajout de mb-4 comme sur le header gauche -->
        <div class="flex items-center gap-3 mb-4">
          <!-- Modification : Conteneur fixe w-8 h-8 (32px) pour matcher l'icône de gauche -->
          <div class="w-8 h-8 flex items-center justify-center flex-shrink-0">
            <span class="text-3xl font-bold leading-none" style="transform: translateY(-2px);">€</span>
          </div>
          <!-- Modification : taille titre forcée à 20px -->
          <h2 class="font-bold" style="font-size: 20px;">Résultat</h2>
        </div>
        
        <!-- AJOUT : Paragraphe invisible pour forcer la même hauteur que le bandeau de gauche -->
        <p class="text-transparent text-sm select-none">Renseignez vos informations pour calculer votre facture estimée</p>
      </div>

      <!-- Contenu blanc -->
      <div class="content-area">
        <img src="https://d11o8pt3cttu38.cloudfront.net/wp-content/uploads/sites/12/2025/10/edf-2-logo-png-transparent.png" alt="EDF" class="w-28 mb-6 mx-auto">
        
        <!-- Montant principal -->
        <!-- Modification : Suppression du titre, ajout de flex/justify-center/items-center pour le centrage parfait, et min-height -->
        <div class="radius-5 p-6 text-center shadow-sm border flex flex-col justify-center items-center" style="background-color: #F0FDFA; border-color: #99F6E4; min-height: 140px;">
          <div class="result-amount mb-2" style="color: #11766E;" id="monthlyBill">0,00 €/mois</div>
          <p class="text-base" style="color: #11766E;" id="annualBill">soit 0,00 €/an HT</p>
        </div>

        <!-- NOUVEAU : Wrapper pour grouper les 2 CTAs et forcer l'écart exact de 15px -->
        <!-- Cela isole ces boutons du "gap" de 24px du parent .content-area -->
        <div class="w-full flex flex-col gap-[15px]">
          
          <!-- CTA : Réduire ma facture -->
          <!-- Suppression de la marge mb-[15px] car gérée par le gap du wrapper -->
          <a href="https://www.papernest.com/demarches-energie/estimer-votre-consommation/" target="_blank" class="w-full flex justify-center items-center gap-2 bg-[#14B8A6] text-white font-semibold py-3 px-6 radius-5 hover:bg-[#0C9488] transition-all duration-300 shadow-md hover:shadow-lg text-center no-underline">
            Réduire ma facture
          </a>

          <!-- Bouton détails -->
          <div class="w-full mb-6" style="position: relative; overflow: visible;">
            <button id="toggleDetails" aria-expanded="false" class="w-full flex justify-center items-center gap-2 bg-white border border-[#1F40AF] text-[#1F40AF] font-semibold py-3 px-6 radius-5 hover:bg-gray-50 transition-all duration-300 shadow-md hover:shadow-lg z-10 relative">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              Afficher les détails
            </button>
            
            <!-- Bloc Détails Accordéon -->
            <div id="detailsPopover" role="region" aria-hidden="true">
              
              <div class="detail-row">
                <span class="detail-label">Prix du kWh Fixe :</span>
                <span class="detail-value" id="kwhDetail">0,1316 €</span>
              </div>

              <div class="detail-row">
                <span class="detail-label">Abonnement (selon puissance) :</span>
                <span class="detail-value" id="abonnementDetail">Ajusté à votre puissance sélectionnée.</span>
              </div>

              <div class="detail-row">
                <span class="detail-label">Type de contrat :</span>
                <span class="detail-value">Sans engagement, Tarif réglementé.</span>
              </div>

            </div>
          </div>
        
        </div> <!-- Fin du wrapper CTA -->

      </div>
    </div>

  </div>
</div>

<script>
const consumptionInput = document.getElementById('consumption');
const powerInput = document.getElementById('power');
const consumptionValueDisplay = document.getElementById('consumptionValue');
const powerValueDisplay = document.getElementById('powerValue');
const monthlyBillDisplay = document.getElementById('monthlyBill');
const annualBillDisplay = document.getElementById('annualBill');
const toggleBtn = document.getElementById('toggleDetails');
const detailsPopover = document.getElementById('detailsPopover');
const kwhDetail = document.getElementById('kwhDetail');
const abonnementDetail = document.getElementById('abonnementDetail');
const warningMessage = document.getElementById('warningMessage');
const hphcInfoIcon = document.getElementById('hphcInfoIcon');

let SIMULATION_PRICES = [];
let selectedOption = 'Base';
let dataLoaded = false;

const powerValues = [3, 6, 9, 12, 24, 30, 36];

const optionButtons = document.querySelectorAll('.option-button[data-option]');
optionButtons.forEach(btn => {
  btn.addEventListener('click', e => {
    optionButtons.forEach(b => b.classList.remove('active'));
    e.currentTarget.classList.add('active');
    selectedOption = e.currentTarget.dataset.option;
    
    if (selectedOption === 'HPHC') {
      hphcInfoIcon.classList.remove('hidden');
    } else {
      hphcInfoIcon.classList.add('hidden');
    }

    checkWarning();
    if(dataLoaded) calculateBill();
  });
});

function updateRangeDisplay(input, display, unit) {
  const val = parseInt(input.value);
  const min = parseInt(input.min);
  const max = parseInt(input.max);
  const percent = ((val - min) / (max - min)) * 100;
  input.style.setProperty('--range-progress', `${percent}%`);
  
  if (input.id === 'power') {
    const actualValue = powerValues[val];
    display.textContent = `${actualValue} ${unit}`;
  } else {
    display.textContent = `${val.toLocaleString('fr-FR')} ${unit}`;
  }
}

function checkWarning() {
  const powerIndex = parseInt(powerInput.value);
  const power = powerValues[powerIndex];
  
  if (selectedOption === 'HPHC' && power === 3) {
    warningMessage.classList.remove('hidden');
    warningMessage.classList.add('flex');
  } else {
    warningMessage.classList.remove('flex');
    warningMessage.classList.add('hidden');
  }
}

function calculateBill() {
  if(!dataLoaded) return;
  const consumption = parseInt(consumptionInput.value);
  const powerIndex = parseInt(powerInput.value);
  const power = powerValues[powerIndex];
  const line = SIMULATION_PRICES.find(r => r.puissance === power);
  
  if(!line) return;

  const monthlyAbonnement = line.abonnement / 12;
  let monthlyConsumptionCost = 0;

  if(selectedOption === 'Base') {
    monthlyConsumptionCost = consumption * line.kwh / 12;
    // Ajout d'un espace avant le symbole € pour la lisibilité
    kwhDetail.textContent = `${line.kwh.toFixed(4).replace('.', ',')} €`;
  } else {
    if (line.kwh_hp === null || line.kwh_hc === null) return;
    monthlyConsumptionCost = ((consumption*0.6*line.kwh_hp) + (consumption*0.4*line.kwh_hc))/12;
    // Ajout d'un espace avant le symbole € pour la lisibilité
    kwhDetail.textContent = `HP : ${line.kwh_hp.toFixed(4).replace('.', ',')} € | HC : ${line.kwh_hc.toFixed(4).replace('.', ',')} €`;
  }

  const totalMonthly = monthlyAbonnement + monthlyConsumptionCost;
  // Ajout d'un espace avant le symbole € pour la lisibilité
  monthlyBillDisplay.textContent = `${totalMonthly.toFixed(2).replace('.', ',')} €/mois`;
  annualBillDisplay.textContent = `soit ${(totalMonthly*12).toFixed(2).replace('.', ',')} €/an HT`;
  
  // Ajout d'un espace avant le symbole € pour la lisibilité
  abonnementDetail.textContent = `${line.abonnement.toFixed(2).replace('.', ',')} €/an (${monthlyAbonnement.toFixed(2).replace('.', ',')} €/mois)`;
}

toggleBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  const isShown = detailsPopover.classList.toggle('show');
  toggleBtn.setAttribute('aria-expanded', String(isShown));
  detailsPopover.setAttribute('aria-hidden', String(!isShown));
  
  if(isShown) {
      toggleBtn.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd"/></svg>
        Masquer les détails
      `;
  } else {
      toggleBtn.innerHTML = `
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>
        Afficher les détails
      `;
  }
});

consumptionInput.addEventListener('input', () => { 
  updateRangeDisplay(consumptionInput, consumptionValueDisplay, 'kWh'); 
  calculateBill(); 
});

powerInput.addEventListener('input', () => { 
  updateRangeDisplay(powerInput, powerValueDisplay, 'kVA');
  checkWarning();
  calculateBill(); 
});

async function fetchTarif() {
  SIMULATION_PRICES = [
    { puissance: 3, abonnement: 126.00, kwh: 0.1316, kwh_hp: null, kwh_hc: null },
    { puissance: 6, abonnement: 158.88, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 9, abonnement: 190.56, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 12, abonnement: 222.24, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 15, abonnement: 253.44, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 18, abonnement: 283.56, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 24, abonnement: 349.32, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 30, abonnement: 414.48, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 },
    { puissance: 36, abonnement: 479.16, kwh: 0.1316, kwh_hp: 0.1370, kwh_hc: 0.1109 }
  ];

  dataLoaded = true;
  calculateBill();
}

window.addEventListener('DOMContentLoaded', () => {
  updateRangeDisplay(consumptionInput, consumptionValueDisplay, 'kWh');
  updateRangeDisplay(powerInput, powerValueDisplay, 'kVA');
  fetchTarif();
});
</script>
</body>
</html>
